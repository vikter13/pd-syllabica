{% extends "base.html" %}

{% block content %}
<div class="container-fluid mt-3">
  <h1 class="mb-3">Базы данных — таблица texts</h1>

  <form method="get" class="mb-3">
    <div class="input-group" style="max-width: 600px;">
      <input
        type="text"
        name="q"
        class="form-control"
        placeholder="Поиск по названию / тексту / автору"
        value="{{ q }}"
      >
      <button class="btn btn-primary" type="submit">Запрос</button>
    </div>
  </form>

  <p class="mb-2">
    Найдено записей: {{ total }}. Страница {{ page }} из {{ page_count }}.
  </p>

  <div class="table-responsive" style="max-height: 70vh; overflow-y: auto; overflow-x: auto; border: 1px solid #dee2e6;">
    <table class="table table-bordered table-sm mb-0">
      <thead class="table-light">
        <tr>
          {% for col in columns %}
            <th scope="col">{{ col }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
          <tr>
            {% for col in columns %}
              {% set value = row[col] %}
              <td style="max-width: 600px;">
                {% if col == "text" and value %}
                  {{ value[:400] }}{% if value|length > 400 %}…{% endif %}
                {% else %}
                  {{ value }}
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <nav aria-label="Пагинация" class="mt-3">
      <div class="d-flex justify-content-center">
        <ul class="pagination">
          <li class="page-item {% if page <= 1 %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('db_view.list', q=q, page=1) }}">Первая</a>
          </li>
          <li class="page-item {% if page <= 1 %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('db_view.list', q=q, page=page-1 if page>1 else 1) }}">Назад</a>
          </li>

          {% for p in page_numbers %}
            <li class="page-item {% if p == page %}active{% endif %}">
              <a class="page-link" href="{{ url_for('db_view.list', q=q, page=p) }}">{{ p }}</a>
            </li>
          {% endfor %}

          <li class="page-item {% if page >= page_count %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('db_view.list', q=q, page=page+1 if page<page_count else page_count) }}">Вперёд</a>
          </li>
          <li class="page-item {% if page >= page_count %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('db_view.list', q=q, page=page_count) }}">Последняя</a>
          </li>
        </ul>
      </div>
  </nav>
</div>
{% endblock %}